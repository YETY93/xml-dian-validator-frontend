src/app/app.config.ts
src/app/app.html
src/app/app.routes.ts
src/app/app.scss
src/app/app.spec.ts
src/app/app.ts
src/app/core/services/xml-validation.service.ts
src/app/core/models/xml-validation-response.model.ts
src/app/core/models/xml-validation-request.model.ts
src/app/core/models/enums/status-error-enum.ts
src/app/core/models/enums/type-doucument-enum.ts
src/app/core/models/enums/validation-errorType-enum.ts
src/app/core/models/validation-error.ts
src/app/core/models/api-response.ts
src/app/core/models/xml-validation-result.ts
src/app/core/core.module.ts
src/app/features/validation/validation.component.ts
src/app/features/validation/validation.component.html
src/app/features/validation/validation.component.scss
src/index.html
src/main.ts
src/styles.scss
import { ApplicationConfig, provideBrowserGlobalErrorListeners } from '@angular/core';
import { provideRouter } from '@angular/router';

import { routes } from './app.routes';
import { es_ES, provideNzI18n } from 'ng-zorro-antd/i18n';
import { registerLocaleData } from '@angular/common';
import es from '@angular/common/locales/es';
import { provideHttpClient } from '@angular/common/http';

registerLocaleData(es);

export const appConfig: ApplicationConfig = {
  providers: [
    provideBrowserGlobalErrorListeners(),
    provideRouter(routes),
    provideNzI18n(es_ES),
    provideHttpClient(),
  ],
};

<nz-layout>
  <nz-header>Validador XML DIAN</nz-header>

  <nz-content style="padding: 24px">
    <router-outlet></router-outlet>
  </nz-content>

  <nz-footer>© DIAN Validator</nz-footer>
</nz-layout>

import { Routes } from '@angular/router';

export const routes: Routes = [
	{ path: '', redirectTo: 'validation', pathMatch: 'full' },
	{
		path: 'validation',
		loadComponent: () =>
			import('./features/validation/validation.component').then(
				(m) => m.ValidationComponent
			)
	},
	{ path: '**', redirectTo: 'validation' }
];


import { TestBed } from '@angular/core/testing';
import { App } from './app';

describe('App', () => {
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [App],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(App);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it('should render title', async () => {
    const fixture = TestBed.createComponent(App);
    await fixture.whenStable();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('h1')?.textContent).toContain('Hello, dian-xml-validator-front');
  });
});

import { Component, signal } from '@angular/core';
import { RouterOutlet } from '@angular/router';
import { NzContentComponent, NzFooterComponent, NzHeaderComponent, NzLayoutComponent } from 'ng-zorro-antd/layout';

@Component({
  selector: 'app-root',
  templateUrl: './app.html',
  styleUrl: './app.scss',
  imports: [RouterOutlet,
    NzLayoutComponent,
    NzHeaderComponent,
    NzContentComponent,
    NzFooterComponent
  ],
})
export class App {
  protected readonly title = signal('dian-xml-validator-front');
}

import { Injectable } from "@angular/core";
import { XmlValidationRequest } from "../models/xml-validation-request.model";
import { Observable } from "rxjs";
import { XmlValidationResponse } from "../models/xml-validation-response.model";
import { HttpClient } from "@angular/common/http";
import { XmlValidationResult } from "../models/xml-validation-result";
import { ApiResponse } from "../models/api-response";

@Injectable({
  providedIn: 'root',
})
export class XmlvalidationsService {
  private readonly API_BASE_URL = 'http://localhost:8080';
  private readonly API_URL = '/api/xml/validate';

  constructor(private http: HttpClient) {}

  validateXml(request: XmlValidationRequest): Observable<ApiResponse<XmlValidationResult>> {
    const url = `${this.API_BASE_URL}${this.API_URL}`;
    return this.http.post<ApiResponse<XmlValidationResult>>(url, request);
  }
}

import { EstatusErrorEnum } from "./enums/status-error-enum";

export interface XmlValidationResponse {
  success: boolean;
  status: string;
  action: string;
  errors: string[];
  maxSeverity: EstatusErrorEnum;
}

import { TypeDocumentEnum } from "./enums/type-doucument-enum";

export interface XmlValidationRequest {
  documentType: TypeDocumentEnum;
  xml: string;
  technicalKey?: string;
}

export enum EstatusErrorEnum {
  INFO = 'info',
  WARNING = 'warning',
  ERROR = 'error',
}

export enum TypeDocumentEnum {
  INVOICE = 'INVOICE',
  CREDIT_NOTE = 'CREDIT_NOTE',
  DEBIT_NOTE = 'DEBIT_NOTE',
  DOCUMENTO_SOPORTE = 'DOCUMENTO_SOPORTE'
}

export enum ValidationErrorType {
  XSD = 'XSD',
  SEMANTIC = 'SEMANTIC',
  SIGNATURE = 'SIGNATURE',
}

import { EstatusErrorEnum } from "./enums/status-error-enum";
import { ValidationErrorType } from "./enums/validation-errorType-enum";

export interface ValidationError {
  type: ValidationErrorType;
  severity: EstatusErrorEnum;
  message: string;
}

export interface ApiResponse<T> {
  success: boolean;
  status: 'SUCCESS' | 'ERROR';
  code: string;
  action: string;
  lastAction: string;
  data: T;
}

import { EstatusErrorEnum } from "./enums/status-error-enum";
import { ValidationError } from "./validation-error";

export interface XmlValidationResult {
  valid: boolean;
  maxSeverity: EstatusErrorEnum;
  errors: ValidationError[];
}


import { CommonModule } from '@angular/common';
import { Component, inject, signal } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { NzAlertModule } from 'ng-zorro-antd/alert';
import { NzButtonModule } from 'ng-zorro-antd/button';
import { NzCardModule } from 'ng-zorro-antd/card';
import { NzFormModule } from 'ng-zorro-antd/form';
import { NzInputModule } from 'ng-zorro-antd/input';
import { NzSelectModule } from 'ng-zorro-antd/select';
import { XmlvalidationsService } from '../../core/services/xml-validation.service';
import { TypeDocumentEnum } from '../../core/models/enums/type-doucument-enum';
import { EstatusErrorEnum } from '../../core/models/enums/status-error-enum';
import { NzTagComponent } from 'ng-zorro-antd/tag';

@Component({
  selector: 'app-validation',
  templateUrl: './validation.component.html',
  styleUrls: ['./validation.component.scss'],
  imports: [
    CommonModule,
    FormsModule,
    NzCardModule,
    NzFormModule,
    NzSelectModule,
    NzInputModule,
    NzButtonModule,
    NzAlertModule,
    NzTagComponent,
  ],
})
export class ValidationComponent {
  private service = inject(XmlvalidationsService);

  documentType = signal<TypeDocumentEnum>(TypeDocumentEnum.INVOICE);
  xml = signal<string>('');
  technicalKey = signal<string>('');
  errors = signal<{ type: EstatusErrorEnum; message: string }[]>([]);
  maxSeverity = signal<EstatusErrorEnum | null>(null);

  protected readonly TypeDocumentEnum = TypeDocumentEnum;

  validate() {
    this.errors.set([]);
    this.maxSeverity.set(null);
    this.service
      .validateXml({
        documentType: this.documentType(),
        xml: this.xml(),
        technicalKey: this.technicalKey(),
      })
      .subscribe({
        next: ({ data }) => {
          this.maxSeverity.set(data.maxSeverity);
          const mappedErrors = data.errors.map((error: any) => ({
            message: error.message,
            type: this.getSeverityType(error.message),
          }));
          this.errors.set(mappedErrors);
        },
        error: (err) => {
          this.maxSeverity.set(EstatusErrorEnum.ERROR);
          this.errors.set([
            {
              type: EstatusErrorEnum.ERROR,
              message: 'Error técnico al conectar con el servidor de validación',
            },
          ]);
          console.error('Validation Error:', err);
        },
      });
  }

  // Función auxiliar para mantener el 'next' limpio
  private getSeverityType(message: string): EstatusErrorEnum {
    if (message.startsWith('ERROR')) return EstatusErrorEnum.ERROR;
    if (message.startsWith('WARNING')) return EstatusErrorEnum.WARNING;
    return EstatusErrorEnum.INFO;
  }

  getSeverityColor(severity: EstatusErrorEnum): string {
    switch (severity) {
      case EstatusErrorEnum.ERROR:
        return 'red';
      case EstatusErrorEnum.WARNING:
        return 'orange';
      case EstatusErrorEnum.INFO:
        return 'green';
      default:
        return 'default';
    }
  }

  getSeverityLabel(severity: EstatusErrorEnum): string {
    switch (severity) {
      case EstatusErrorEnum.ERROR:
        return '❌ Documento inválido';
      case EstatusErrorEnum.WARNING:
        return '⚠️ Documento con advertencias';
      case EstatusErrorEnum.INFO:
        return '✅ Documento válido';
    }
  }
}

<nz-card nzTitle="Validador XML DIAN">
@if (maxSeverity()) {
  <div style="margin-bottom: 16px">
    <nz-tag
      [nzColor]="getSeverityColor(maxSeverity()!)">
      {{ getSeverityLabel(maxSeverity()!) }}
    </nz-tag>
  </div>
}
<nz-form-item>
    <nz-form-label>Tipo de documento</nz-form-label>
    <nz-form-control>
      <nz-select [ngModel]="documentType()" (ngModelChange)="documentType.set($event)">
        <nz-option [nzValue]="TypeDocumentEnum.INVOICE" nzLabel="Factura electrónica"></nz-option>
        <nz-option [nzValue]="TypeDocumentEnum.CREDIT_NOTE" nzLabel="Nota crédito" nzDisabled="true"></nz-option>
        <nz-option [nzValue]="TypeDocumentEnum.DEBIT_NOTE" nzLabel="Nota débito" nzDisabled="true"></nz-option>
        <nz-option [nzValue]="TypeDocumentEnum.DOCUMENTO_SOPORTE" nzLabel="Documento Soporte" nzDisabled="true"></nz-option>
      </nz-select>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item>
    <nz-form-label>XML</nz-form-label>
    <nz-form-control>
      <textarea nz-input rows="10"
        [ngModel]="xml()"
        (ngModelChange)="xml.set($event)">
      </textarea>
    </nz-form-control>
  </nz-form-item>

  <nz-form-item>
    <nz-form-label>Clave técnica (opcional)</nz-form-label>
    <nz-form-control>
      <input nz-input [(ngModel)]="technicalKey"/>
    </nz-form-control>
  </nz-form-item>

  <button nz-button nzType="primary" (click)="validate()">Validar</button>

@for (error of errors(); track $index) {
  <nz-alert
    [nzType]="error.type"
    [nzMessage]="error.message"
    nzShowIcon>
  </nz-alert>
}
</nz-card>


<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>DianXmlValidatorFront</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <app-root></app-root>
</body>
</html>

import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { App } from './app/app';

bootstrapApplication(App, appConfig)
  .catch((err) => console.error(err));

/* You can add global styles to this file, and also import other style files */

