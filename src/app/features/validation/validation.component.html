<nz-card [nzBordered]="false" class="validation-card">
  <div class="card-header">
    <div class="title-section">
      <span nz-icon nzType="file-search" nzTheme="outline" class="title-icon"></span>
      <h2>Validación de Documento</h2>
    </div>
    @if (validated() && maxSeverity()) {
      <nz-tag [nzColor]="maxSeverity() === ErrorStatus.INFO ? 'success' : 'error'" class="status-tag">
        <span nz-icon [nzType]="maxSeverity() === ErrorStatus.INFO ? 'check-circle' : 'exclamation-circle'"></span>
        {{ maxSeverity() === ErrorStatus.INFO ? 'Documento Válido' : 'Documento Inválido' }}
      </nz-tag>
    }
  </div>

  <nz-divider></nz-divider>

  <form nz-form nzLayout="vertical">
    <app-validation-form
      [documentType]="documentType()"
      [technicalKey]="technicalKey()"
      [loading]="loading()"
      [disabled]="!canValidate()"
      (documentTypeChange)="onDocumentTypeChange($event)"
      (technicalKeyChange)="onTechnicalKeyChange($event)"
      (validate)="onValidate()"
      (clear)="onClear()"
    />

    <nz-divider></nz-divider>

    <app-file-upload
      [fileName]="fileName()"
      [xml]="xml()"
      [fileLoaded]="fileLoaded()"
      (fileSelected)="onFileSelected($event)"
      (fileReset)="onFileReset()"
    />
  </form>

  @if (loading()) {
    <div class="loading-container">
      <nz-spin nzSimple nzSize="large" nzTip="Validando documento..."></nz-spin>
    </div>
  }

  @if (errors().length > 0) {
    <div class="error-banner-section">
      @for (err of errors(); track $index) {
        <nz-alert [nzType]="err.type" [nzMessage]="err.message" nzShowIcon nzBanner class="error-banner"></nz-alert>
      }
    </div>
  }

  @if (validated()) {
    <div class="results-section">
      <app-validation-results
        [maxSeverity]="maxSeverity()"
        [errorsByType]="errorsByType()"
      />
    </div>
  }
</nz-card>
